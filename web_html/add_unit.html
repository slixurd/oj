<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>为课程添加实验\作业</title>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="css/admin.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
<script type="text/javascript" src="js/admin.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<style type="text/css">
</style>
</head>
<body>
<div class="wrapper">
<div class="container clearfix">
	<ul class="slide-bar pull-left">
		<li><a href="#">题目列表</a></li>
		<li><a href="#">添加题目</a></li>
		<li class="active"><a href="#">课程列表</a></li>
		<li><a href="#">添加课程</a></li>
		<li><a href="#">竞赛列表</a></li>
		<li><a href="#">添加竞赛</a></li>
		<li><a href="#">排名</a></li>
		<li><a href="#">状态</a></li>
		<li><a href="#">账号生成器</a></li>
		<li><a href="#">权限管理</a></li>
		<li><a href="#">修改密码</a></li>
		<li><a href="#">新手须知</a></li>
	</ul>

	<div class="add-tab pull-right">
		<table class="table">
			<caption>单元列表</caption>
			<thead>
				<tr>
					<th class="span1">单元ID</th>
					<th class="span7">名称</th>
					<th class="span6">开始时间</th>
					<th class="span6">结束时间</th>
					<th class="span2">编辑</th>
					<th class="span2">删除</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>1001</td>
					<td title="数据结构数据结构数据结构">数据结构数据结构数据结构</td>
					<td>2014-07-21 14:00</td>
					<td>2015-08-11 14:00</td>
					<td><a class="edit" href="#">编辑</a></td>
					<td><a class="pdel" href="#">删除</a></td>
				</tr>
				<tr>
					<td>1002</td>
					<td title="数据结构数据结构数据结构">数据结构数据结构数据结构</td>
					<td>2014-07-21 14:00</td>
					<td>2025-08-11 14:40</td>
					<td><a class="edit" href="#">编辑</a></td>
					<td><a class="pdel" href="#">删除</a></td>
				</tr>
				<tr>
					<td>1003</td>
					<td title="数据结构数据结构数据结构">数据结构数据结构数据结构</td>
					<td>2014-07-21 14:00</td>
					<td>2014-11-01 16:00</td>
					<td><a class="edit" href="#">编辑</a></td>
					<td><a class="pdel" href="#">删除</a></td>
				</tr>
				<tr>
					<td>1004</td>
					<td title="数据结构数据结构数据结构">数据结构数据结构数据结构</td>
					<td class="stime">2014-07-21 14:00</td>
					<td>2017-07-21 14:00</td>
					<td><a class="edit" href="#">编辑</a></td>
					<td><a class="pdel" href="#">删除</a></td>
				</tr>
			</tbody>
		</table>

		<div>
			<h3>新建单元</h3>
			<div class="row">
				<span class="tip">名称：</span>
				<input class="necessary" id="title" type="text" name="title" />
			</div>
			<div class="row">
				<span class="tip">开始时间：</span>
				<div class="select-down">
					<span class="select-down-span year placeholder">年<i class="down"></i></span>
					<select class="select-down-select year" autocomplete="off" id="syear" name="start_year">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span month placeholder">月<i class="down"></i></span>
					<select class="select-down-select month" autocomplete="off" id="smonth" name="start_mon">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span date placeholder">日<i class="down"></i></span>
					<select class="select-down-select date" autocomplete="off" id="sdate" name="start_date">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span hour placeholder">时<i class="down"></i></span>
					<select class="select-down-select hour" autocomplete="off" id="shour" name="start_hour">
					</select>
				</div>
				<div class="select-down last-child">
					<span class="select-down-span minute placeholder">分<i class="down"></i></span>
					<select class="select-down-select minute" autocomplete="off" id="sminute" name="start_min">
					</select>
				</div>
			</div>
			<div class="row">
				<span class="tip">结束时间：</span>
				<div class="select-down">
					<span class="select-down-span year placeholder">年<i class="down"></i></span>
					<select class="select-down-select year" autocomplete="off" id="eyear" name="end_year">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span month placeholder">月<i class="down"></i></span>
					<select class="select-down-select month" autocomplete="off" id="emonth" name="end_mon">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span date placeholder">日<i class="down"></i></span>
					<select class="select-down-select date" autocomplete="off" id="edate" name="end_date">
					</select>
				</div>
				<div class="select-down">
					<span class="select-down-span hour placeholder">时<i class="down"></i></span>
					<select class="select-down-select hour" autocomplete="off" id="ehour" name="end_hour">
					</select>
				</div>
				<div class="select-down last-child"> 
					<span class="select-down-span minute placeholder">分<i class="down"></i></span>
					<select class="select-down-select minute" autocomplete="off" id="eminute" name="end_min">
					</select>
				</div>
			</div>
			<div class="row">
				<span class="tip">编程语言：</span>
				<div class="select-down" id="language">
					<span class="select-down-span placeholder">C++<i class="down"></i></span>
					<select class="select-down-select" id="lang">
						<option value="0">C</option>
						<option value="1">C++</option>
						<option value="2">Pascal</option>
						<option value="3">Java</option>
						<option value="4">Ruby</option>
						<option value="5">Bash</option>
						<option value="6">Python</option>
						<option value="7">PHP</option>
						<option value="8">Perl</option>
						<option value="9">C#</option>
						<option value="10">Obj-C</option>
						<option value="11">Free Basic</option>
					</select>
				</div>
			</div>
			<div class="submit-footer">
				<input id="submit" type="button" class="btn" value="确认添加" />
			</div>
		</div>
	</div>
</div>

<!--修改时间模态对话框 -->
<div style="width:50%" id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <a class="close pull-right" onmouseover="this.style.opacity=0.6" onmouseout="this.style.opacity=1"style="cursor:pointer" data-dismiss="modal" aria-hidden="true">×</a>
    <h3 id="myModalLabel">修改单元时间</h3>
  </div>
  <div class="modal-body">
  	<input id="unitid" class="hidden" />
    <div class="row">
		<span class="tip">开始时间：</span>
		<div class="select-down">
			<span class="select-down-span year placeholder">年<i class="down"></i></span>
			<select class="select-down-select year" autocomplete="off" id="m_syear">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span month placeholder">月<i class="down"></i></span>
			<select class="select-down-select month" autocomplete="off" id="m_smonth">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span date placeholder">日<i class="down"></i></span>
			<select class="select-down-select date" autocomplete="off" id="m_sdate">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span hour placeholder">时<i class="down"></i></span>
			<select class="select-down-select hour" autocomplete="off" id="m_shour" >
			</select>
		</div>
		<div class="select-down last-child">
			<span class="select-down-span minute placeholder">分<i class="down"></i></span>
			<select class="select-down-select minute" autocomplete="off" id="m_sminute">
			</select>
		</div>
	</div>
	<div class="row">
		<span class="tip">结束时间：</span>
		<div class="select-down">
			<span class="select-down-span year placeholder">年<i class="down"></i></span>
			<select class="select-down-select year" autocomplete="off" id="m_eyear">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span month placeholder">月<i class="down"></i></span>
			<select class="select-down-select month" autocomplete="off" id="m_emonth">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span date placeholder">日<i class="down"></i></span>
			<select class="select-down-select date" autocomplete="off" id="m_edate">
			</select>
		</div>
		<div class="select-down">
			<span class="select-down-span hour placeholder">时<i class="down"></i></span>
			<select class="select-down-select hour" autocomplete="off" id="m_ehour">
			</select>
		</div>
		<div class="select-down last-child"> 
			<span class="select-down-span minute placeholder">分<i class="down"></i></span>
			<select class="select-down-select minute" autocomplete="off" id="m_eminute">
			</select>
		</div>
	</div>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
    <button id="mode" style="margin-right:55px;" class="btn btn-primary">确认修改</button>
  </div>
</div>
<script type="text/javascript">
	doSelect();
	loadTimeWidget();

	$('body').on('click','.pdel',function(event) {
		$(this).parents('tr').fadeOut();
	})
	
	$('#submit').bind('click', function(event) {
        if(!check_ness()) {
            return false;
        }

        var url = 'http://www.baidu.com';
        var title,lang;
        var syear,smonth,sdate,shour,sminute,stime;
        var eyear,emonth,edate,ehour,eminute,etime;

        title = $('#title').val();
        lang = $('#lang').val();

        syear = $('#syear').val();
        smonth = parseInt($('#smonth').val()) < 10 ? '0' + $('#smonth').val() : $('#smonth').val();
        sdate = parseInt($('#sdate').val()) < 10 ? '0' + $('#sdate').val() : $('#sdate').val();
        if($('#shour')[0])
            shour = parseInt($('#shour').val()) < 10 ? '0' + $('#shour').val() : $('#shour').val();
        else 
            shour = '00';
        if($('#sminute')[0])
            sminute = parseInt($('#sminute').val()) < 10 ? '0' + $('#sminute').val() : $('#sminute').val();
         else 
            sminute = '00';

        eyear = $('#eyear').val();
        emonth = parseInt($('#emonth').val()) < 10 ? '0' + $('#emonth').val() : $('#emonth').val();
        edate = parseInt($('#edate').val()) < 10 ? '0' + $('#edate').val() : $('#edate').val();
        if($('#ehour')[0])
            ehour = parseInt($('#ehour').val()) < 10 ? '0' + $('#ehour').val() : $('#ehour').val();
        else
            ehour = '00';
        if($('#eminute')[0])
            eminute = parseInt($('#eminute').val()) < 10 ? '0' + $('#eminute').val() : $('#eminute').val();
        else
            eminute = '00';

        stime = syear + '-' + smonth + '-' + sdate + ' ' + shour + ':' + sminute + ':00';
        etime = eyear + '-' + emonth + '-' + edate + ' ' + ehour + ':' + eminute + ':00';
            
        //开始时间必须小于结束时间
        var s = new Date(),e = new Date();
        s.setFullYear(parseInt(syear));
        s.setMonth(parseInt(smonth));
        s.setDate(parseInt(sdate));
        s.setHours(parseInt(shour));
        s.setMinutes(parseInt(sminute));
        s.setSeconds(parseInt(0));

        e.setFullYear(parseInt(eyear));
        e.setMonth(parseInt(emonth));
        e.setDate(parseInt(edate));
        e.setHours(parseInt(ehour));
        e.setMinutes(parseInt(eminute));
        e.setSeconds(parseInt(0));

        if(s < e) {
        	$.ajax({
        		url: url,
        		type: 'POST',
        		dataType: 'json',
        		data: {
        			title: title,
        			lang: lang,
        			stime: stime,
        			etime: etime
        		},
        	})
        	.done(function() {
        		console.log("success");
        	})
        	.fail(function() {
        		console.log("error");
        	})
        	.always(function() {
        		console.log("complete");
        	});
        	
        } else {
            if($('#syear').parents('.row')[0] == $('#eyear').parents('.row')[0]){
                myPopover($('#syear').parents('.row'),'开始时间必须小于结束时间','top');
            } else {
                myPopover($('#syear').parents('.row'),'开始时间必须小于结束时间','top');
                myPopover($('#eyear').parents('.row'),'结束时间必须大于开始时间','top');
            }
            return false;
        }
	});

	$('body').on('click', '.edit', function(event) {
		$("#myModal").modal("show");
		$("#unitid").val($(this).parents('tr').children('td:first').text());
		var syear,smonth,sdate,shour,sminute;
		var eyear,emonth,edate,ehour,eminute;
		var regEx = /[- :]/;
		var stime = $(this).parents('tr').children('td:eq(2)').text().split(regEx);
		var etime = $(this).parents('tr').children('td:eq(3)').text().split(regEx);
		$("#m_syear").prev("span").html(stime[0] + " 年<i class='down'></i>");
		$("#m_syear option[value=" + (+stime[0]) + "]").prop('selected', 'true');

		$("#m_smonth").prev("span").html(stime[1] + " 月<i class='down'></i>");
		$("#m_smonth option[value=" + (+stime[1]) + "]").prop('selected', 'true');
		
		$("#m_sdate").prev("span").html(stime[2] + " 日<i class='down'></i>");
		$("#m_sdate option[value=" + (+stime[2]) + "]").prop('selected', 'true');

		$("#m_shour").prev("span").html(stime[3] + " 时<i class='down'></i>");
		$("#m_shour option[value=" + (+stime[3]) + "]").prop('selected', 'true');

		$("#m_sminute").prev("span").html(stime[4] + " 分<i class='down'></i>");
		$("#m_sminute option[value=" + (+stime[4]) + "]").prop('selected', 'true');

		$("#m_eyear").prev("span").html(etime[0] + " 年<i class='down'></i>");
		$("#m_eyear option[value=" + (+etime[0]) + "]").prop('selected', 'true');

		$("#m_emonth").prev("span").html(etime[1] + " 月<i class='down'></i>");
		$("#m_emonth option[value=" + (+etime[1]) + "]").prop('selected', 'true');

		$("#m_edate").prev("span").html(etime[2] + " 日<i class='down'></i>");
		$("#m_edate option[value=" + (+etime[2]) + "]").prop('selected', 'true');

		$("#m_ehour").prev("span").html(etime[3] + " 时<i class='down'></i>");
		$("#m_ehour option[value=" + (+etime[3]) + "]").prop('selected', 'true');

		$("#m_eminute").prev("span").html(etime[4] + " 分<i class='down'></i>");
		$("#m_eminute option[value=" + (+etime[4]) + "]").prop('selected', 'true');
	})

/*
*	修改时间
*/
	$('#mode').bind('click', function(event) {
        var url = 'http://www.baidu.com';
        var unitid = $("#unitid").val();
        var syear,smonth,sdate,shour,sminute,stime;
        var eyear,emonth,edate,ehour,eminute,etime;

        syear = $('#m_syear').val();
        smonth = parseInt($('#m_smonth').val()) < 10 ? '0' + $('#m_smonth').val() : $('#m_smonth').val();
        sdate = parseInt($('#m_sdate').val()) < 10 ? '0' + $('#m_sdate').val() : $('#m_sdate').val();
        if($('#shour')[0])
            shour = parseInt($('#m_shour').val()) < 10 ? '0' + $('#m_shour').val() : $('#m_shour').val();
        else 
            shour = '00';
        if($('#m_sminute')[0])
            sminute = parseInt($('#m_sminute').val()) < 10 ? '0' + $('#m_sminute').val() : $('#m_sminute').val();
         else 
            sminute = '00';

        eyear = $('#m_eyear').val();
        emonth = parseInt($('#m_emonth').val()) < 10 ? '0' + $('#m_emonth').val() : $('#m_emonth').val();
        edate = parseInt($('#m_edate').val()) < 10 ? '0' + $('#m_edate').val() : $('#m_edate').val();
        if($('#m_ehour')[0])
            ehour = parseInt($('#m_ehour').val()) < 10 ? '0' + $('#m_ehour').val() : $('#m_ehour').val();
        else
            ehour = '00';
        if($('#m_minute')[0])
            eminute = parseInt($('#m_eminute').val()) < 10 ? '0' + $('#m_eminute').val() : $('#m_eminute').val();
        else
            eminute = '00';

        stime = syear + '-' + smonth + '-' + sdate + ' ' + shour + ':' + sminute + ':00';
        etime = eyear + '-' + emonth + '-' + edate + ' ' + ehour + ':' + eminute + ':00';
            
        //开始时间必须小于结束时间
        var s = new Date(),e = new Date();
        s.setFullYear(parseInt(syear));
        s.setMonth(parseInt(smonth));
        s.setDate(parseInt(sdate));
        s.setHours(parseInt(shour));
        s.setMinutes(parseInt(sminute));
        s.setSeconds(parseInt(0));

        e.setFullYear(parseInt(eyear));
        e.setMonth(parseInt(emonth));
        e.setDate(parseInt(edate));
        e.setHours(parseInt(ehour));
        e.setMinutes(parseInt(eminute));
        e.setSeconds(parseInt(0));

        if(s < e) {
        	$.ajax({
        		url: url,
        		type: 'POST',
        		dataType: 'json',
        		data: {
        			unitid: unitid,
        			stime: stime,
        			etime: etime
        		},
        	})
        	.done(function() {
        		console.log("success");
        		//成功后可以刷新该页面
        		location.replace(location.href);
        	})
        	.fail(function() {
        		console.log("error");
        	})
        	.always(function() {
        		console.log("complete");
        	});
        	
        } else {
            myPopover($('#m_eyear').parents('.row'),'结束时间必须大于开始时间','top');
            return false;
        }
	});
</script>
</body>
</html>